# 重构并且恢复基本功能

## 新增需求

- **消息管理**  
  优化历史记录保存逻辑（主要是关于 `think` 模型）：
  - **前端**：负责清洗数据发送。
  - **后端**：存放完整数据。

>[!note]
>后端逻辑描述
> 1. 前端发送消息列表包含 think tag
> 2. 后端进行 第一次入库
> 3. 清洗数据，进行知识点注入
> 4. 送入 llm
> 5. 拼接回答 到 首次接到的包含 think tag 的 raw messages 第二次入库

- **conversation会话管理**
  切换会话之后再次发送消息没有把之前的消息进行获取并送到后端。

- **AI 消息功能**
  - 增加重试功能。
  - ~~AI 消息等待过程中的 `loading` 动效丢失，需修复。  ---- 已完成~~

- **新增接口**
  - ~~增加录音接口。  ----  已完成~~
  - 增加播放 AI 消息接口。

- **设计右侧扩展框**  
  设计右侧扩展框（用于工作流展示）。

- **用户交互**
  - ~~用户回车发送消息。   ---- 已完成~~

### 点赞点踩
  ~~新增点赞和点踩功能。   ---- 已完成~~
- TODO 后端 feedback 接口
1. 已完成接口设计。等待数据库设计

### 接口设计
> 1. 批量导出接口未完成
> 2. 知识标注提交后，再次点开还是初始化状态，而不是已提交的状态
> 3. 根据已选择的知识点重新生成ai回答
> 4. 如果处理意见我不选择，然后就直接知识标注进行提交了，就会导致处理意见不能更新

### 会话bug
 - 有时候点踩会没有带上kg_refrence知识点这个参数

## 优化

- **Markdown 渲染**  
  ~~增加几个 Markdown 渲染样式。  ---- 已完成（yr）~~

- **欢迎词渲染逻辑**  
  欢迎词渲染逻辑不该侵入消息列表。 P3

- **项目结构**  
  完成上述任务后，继续重构项目结构。
